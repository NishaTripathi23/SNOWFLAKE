Create database DEMO_DATABASE
USE DATABASE DEMO_DATABASE;


Create or replace TABLE NT_SALES_ORDER
(
ORDER_NUMBER VARCHAR(15),
ORDER_DATE VARCHAR (20),
CUSTOMER_INDEX INT,
CHANNEL VARCHAR(15),
WAREHOUSE_CODE VARCHAR(15),
DELIVERY_REGION_INDEX INT,
PRODUCT_DESCRIPTION_INDEX INT FOREIGN KEY REFERENCES NT_PRODUCTS(PRODUCT_INDEX),
ORDER_QUANTITY INT,
UNIT_PRICE_USD NUMBER (7,2),
TOTAL_REVENUE_USD NUMBER (7,2),
TOTAL_UNIT_COST_USD NUMBER (7,2));

Create OR REPLACE table NT_CUSTOMER_NAME(
CUSTOMER_INDEX INT PRIMARY KEY,
CUSTOMER_NAMES VARCHAR(40));

CREATE OR REPLACE TABLE NT_REGIONS(
REGION_INDEX INT PRIMARY KEY,
CITY VARCHAR (40),
COUNTRY VARCHAR (40));


CREATE OR REPLACE TABLE NT_PRODUCTS (
PRODUCT_INDEX INT PRIMARY KEY,
PRODUCT_NAME VARCHAR (40));

SELECT * FROM NT_CUSTOMER_NAME;
SELECT * FROM NT_REGIONS;
SELECT * FROM NT_PRODUCTS;
SELECT * FROM NT_SALES_ORDER;

CREATE OR REPLACE TABLE NT_CUSTOMER_SALES_ORDER_TABLE AS
SELECT A.*,B.PRODUCT_NAME,C.CITY,C.COUNTRY,C.CITY||'-'||C.COUNTRY AS CITY_COUNTRY, D.CUSTOMER_NAMES,
       CASE WHEN UNIT_PRICE_USD >=1 AND UNIT_PRICE_USD <1001 THEN '$1 TO $1000'
            WHEN UNIT_PRICE_USD >=1001 AND UNIT_PRICE_USD <2001 THEN '$1OO1 TO $2000'            
            WHEN UNIT_PRICE_USD >=2001 AND UNIT_PRICE_USD <3001 THEN '$2001 TO $3000'
            WHEN UNIT_PRICE_USD >=3001 AND UNIT_PRICE_USD <4001 THEN '$3001 TO $4000'
            WHEN UNIT_PRICE_USD >=4001 AND UNIT_PRICE_USD <1001 THEN '$4001 TO $5000'
            WHEN UNIT_PRICE_USD >=5001 THEN '>5000$'
       END AS FINAL_UNIT_PRICE_BUCKET     
  FROM NT_SALES_ORDER A
INNER JOIN NT_PRODUCTS B ON A.PRODUCT_DESCRIPTION_INDEX = B.PRODUCT_INDEX
INNER JOIN NT_REGIONS C ON A.DELIVERY_REGION_INDEX = C.REGION_INDEX
INNER JOIN NT_CUSTOMER_NAME D ON A.CUSTOMER_INDEX = D.CUSTOMER_INDEX;

DESCRIBE TABLE NT_CUSTOMER_SALES_ORDER_TABLE;

SELECT * FROM NT_CUSTOMER_SALES_ORDER_TABLE;

SELECT CHANNEL, COUNT (ORDER_NUMBER) FROM NT_CUSTOMER_SALES_ORDER_VIEW
GROUP BY 1
ORDER BY 1;

-----HOW TO CLUB CITY CITY AND COUNTRY IN ONE COLUMN----

SELECT CITY||'-'||COUNTRY AS CITY_COUNTRY
 FROM NT_CUSTOMER_SALES_ORDER_VIEW;

SELECT CONCAT(CITY, ',', COUNTRY) AS CITY_COUNTRY 
FROM NT_CUSTOMER_SALES_ORDER_VIEW; 

DROP VIEW NT_CUSTOMER_SALES_ORDER_VIEW
