Use Demo_Database;
CREATE or replace table NT_CONSUMER_COMPLAINTS
(    DATE_RECEIVED STRING,
     PRODUCT_NAME VARCHAR(50),
     SUB_PRODUCT VARCHAR(100),
     ISSUE VARCHAR(100),
     SUB_ISSUE VARCHAR(100),
     CONSUMER_COMPLAINT_NARRATIVE string,
     Company_Public_Response STRING,
     Company VARCHAR(100),
     State_Name CHAR(4),
     Zip_Code string,
     Tags VARCHAR(40),
     Consumer_Consent_Provided CHAR(25),
     Submitted_via STRING,
     Date_Sent_to_Company STRING,
     Company_Response_to_Consumer VARCHAR(40),
     Timely_Response VARCHAR(4),
     CONSUMER_DISPUTED VARCHAR(4),
     COMPLAINT_ID NUMBER(12,0) NOT NULL PRIMARY KEY);
     
select * from NT_CONSUMER_COMPLAINTS

---DISTINCT--
SELECT DISTINCT PRODUCT_NAME FROM NT_CONSUMER_COMPLAINTS;
SELECT DISTINCT ISSUE FROM NT_CONSUMER_COMPLAINTS;
SELECT DISTINCT COMPANY FROM NT_CONSUMER_COMPLAINTS;

---LIKE KEYWORD---HIGHLY USED IN SQL-----
--% REPRESNTS ZERO, ONE OR MULTIPLE CHARACTERS--
---__ REPRESENTS ONE SINGLE CHARACTER---
/*
A% MEANS - ANY VALUS START WITH A--
%A MEANS - ANY VALUES END WITH A--
%WORD% MEANS - ANY VALUES THAT HAS WORD IN ANY POSITION--
_A% MEANS ANY VALUE THAT HAS A IN THE SECOND POSITION--
A_% MEANS - ANY VALUES THAT STARTS WITH "A" AND ARE ATLEAST 2 CHARACTERS IN LENGTH---
A__% MEANS - ANY VALUES THAT STARTS WITH "A" AND ARE ATLEAST 3 CHARACTERS IN LENGTH---
A%R MEANS - ANY VALUE STARTS WITH A AND ENDS WITH R
AB%CD%DE%F MEANS - ANY VALUES THAT STARTS WITH AB FOLLOWED BY ANY CHARACTERS AND THEN CD 
AND THEN FOLLOWED BY ANY CHARACTERS AND THEN DE AND FOLLOWED BY ANY CHARTERS AND THEN ENDS WITH F

*/ 
---WHAT ARE THE DIFFERENT PRODUCT NAME STARTING WITH BANK---
SELECT DISTINCT * FROM NT_CONSUMER_COMPLAINTS WHERE PRODUCT_NAME LIKE 'BANK%'; --- % AT THE END MEANS BANK FOLLOWED
BY ANY SEQUENCE OF CHARACTER----
SELECT DISTINCT * FROM NT_CONSUMER_COMPLAINTS WHERE PRODUCT_NAME LIKE '%ACCOUNT%'; ---ANYWHERE WORD ACCOUNT APPEARING IN DATA----
SELECT DISTINCT * FROM NT_CONSUMER_COMPLAINTS WHERE PRODUCT_NAME LIKE '%ACCOUNT'; --ACCOUNT AT THE END---
SELECT DISTINCT * FROM NT_CONSUMER_COMPLAINTS WHERE PRODUCT_NAME LIKE '%ACCOUNT';

-----------IN KEYWORD-------
----THE CLIENT WANTS TO KNOW ALL THE RECORD WHERE THE PRODUCT NAME IS CONSUMER LOAN., MORTGAGE AND DEBT COLLECTION---
SELECT DISTINCT * FROM  NT_CONSUMER_COMPLAINTS WHERE PRODUCT_NAME IN ('Consumer Loan', 'Mortgage', 'Debt Collection');
SELECT DISTINCT * FROM  NT_CONSUMER_COMPLAINTS WHERE COMPANY IN ('Bank of America', 'Citibank');

----BETWEEN---
SELECT DISTINCT * FROM NT_CONSUMER_COMPLAINTS WHERE DATE_RECEIVED BETWEEN '29-07-2013' AND '31-07-2013';

----IF ELSE THEN----
SELECT DISTINCT SUBMITTED_VIA FROM NT_CONSUMER_COMPLAINTS;
SELECT *,
CASE WHEN SUBMITTED_VIA IN ('Referral', 'Postal Mail','Email' ) THEN 'OUTBOUND'
            WHEN SUBMITTED_VIA IN ('Phone', 'Web') THEN 'INBOUND'         
           ELSE 'ELECTRONIC'
       END AS SUBMITTED_TYPE
       FROM NT_CONSUMER_COMPLAINTS

SELECT *,
       CASE 
       WHEN PRODUCT_NAME  like '%Loan'or PRODUCT_NAME like '%loan' THEN 'Loan'
            WHEN PRODUCT_NAME  IN ('Bank account or service', 'Mortgage', 'Debt collection', 'Credit reporting', 'Money transfers') 
            THEN 'Service'         
           ELSE 'other'
       END AS FINANCE_TYPE
       FROM NT_CONSUMER_COMPLAINTS
       
 -----optimized code----
 SELECT *,
       CASE 
       WHEN UPPER (PRODUCT_NAME)  like '%LOAN' THEN 'LOAN'
            WHEN UPPER (PRODUCT_NAME)  IN ('BANK ACCOUNT OR SERVICE', 'MORTGAGE', 'DEBT COLLECTION', 'CREDIT REPORTING', 'MONEY TRANSFERS') 
            THEN 'SERVICE'         
           ELSE 'OTHER'
       END AS FINANCE_TYPE
       FROM NT_CONSUMER_COMPLAINTS
  
  SELECT DISTINCT SUB_PRODUCT FROM NT_CONSUMER_COMPLAINTS
 SELECT *,
       CASE 
       WHEN UPPER (SUB_PRODUCT) = 'I DO NOT KNOW' OR SUB_PRODUCT IS NULL THEN 'NA'
       WHEN UPPER (SUB_PRODUCT) LIKE '%LOAN%' THEN 'LOAN'
       WHEN UPPER (SUB_PRODUCT) LIKE '%ACCOUNT%' THEN 'ACCOUNT'
       WHEN UPPER (SUB_PRODUCT) LIKE '%MORTGAGE%' THEN 'MORTGAGE'
       WHEN UPPER (SUB_PRODUCT) LIKE '%CARD%' THEN 'CARD'
           ELSE SUB_PRODUCT
       END AS SUB_PRODUCT_TYPE
       FROM NT_CONSUMER_COMPLAINTS   
       
   SELECT *,
       CASE 
       WHEN UPPER (COMPANY_RESPONSE_TO_CONSUMER) = 'CLOSED WITH EXPLANATION' THEN 'EXPLAINED'
       WHEN UPPER (COMPANY_RESPONSE_TO_CONSUMER) = 'CLOSED WITH MONETARY RELIEF' THEN 'MONETARY RELIEF PROVIDED'
       WHEN UPPER (COMPANY_RESPONSE_TO_CONSUMER) LIKE '%CLOSED%' THEN 'CLOSED'
       ELSE COMPANY_RESPONSE_TO_CONSUMER
       END AS COMPANY_RESPONSE_TO_CONSUMER_TYPE
       FROM NT_CONSUMER_COMPLAINTS 
       
----MASTER CASE STATEMENT----
CREATE OR REPLACE VIEW NT_COMPANY_RESPONSE_TO_CUSTOMER AS
SELECT PRODUCT_NAME, SUBMITTED_VIA, SUB_PRODUCT, COMPANY_RESPONSE_TO_CONSUMER,
   CASE 
       WHEN UPPER (PRODUCT_NAME)  like '%LOAN' THEN 'LOAN'
       WHEN UPPER (PRODUCT_NAME)  IN ('BANK ACCOUNT OR SERVICE', 'MORTGAGE', 'DEBT COLLECTION', 'CREDIT REPORTING', 'MONEY TRANSFERS') 
       THEN 'SERVICE'         
           ELSE 'OTHER'
             END AS FINANCE_TYPE,
    CASE 
     WHEN SUBMITTED_VIA IN ('Referral', 'Postal Mail','Email' ) THEN 'OUTBOUND'
     WHEN SUBMITTED_VIA IN ('Phone', 'Web') THEN 'INBOUND'         
       ELSE 'ELECTRONIC'
         END AS SUBMITTED_TYPE,
    CASE 
       WHEN UPPER (SUB_PRODUCT) = 'I DO NOT KNOW' OR SUB_PRODUCT IS NULL THEN 'NA'
       WHEN UPPER (SUB_PRODUCT) LIKE '%LOAN%' THEN 'LOAN'
       WHEN UPPER (SUB_PRODUCT) LIKE '%ACCOUNT%' THEN 'ACCOUNT'
       WHEN UPPER (SUB_PRODUCT) LIKE '%MORTGAGE%' THEN 'MORTGAGE'
       WHEN UPPER (SUB_PRODUCT) LIKE '%CARD%' THEN 'CARD'
           ELSE SUB_PRODUCT
            END AS SUB_PRODUCT_TYPE,
     CASE 
       WHEN UPPER (COMPANY_RESPONSE_TO_CONSUMER) = 'CLOSED WITH EXPLANATION' THEN 'EXPLAINED'
       WHEN UPPER (COMPANY_RESPONSE_TO_CONSUMER) = 'CLOSED WITH MONETARY RELIEF' THEN 'MONETARY RELIEF PROVIDED'
       WHEN UPPER (COMPANY_RESPONSE_TO_CONSUMER) LIKE '%CLOSED%' THEN 'CLOSED'
        ELSE COMPANY_RESPONSE_TO_CONSUMER
          END AS COMPANY_RESPONSE_TO_CONSUMER_TYPE
       FROM NT_CONSUMER_COMPLAINTS;
       
  SELECT *  FROM NT_COMPANY_RESPONSE_TO_CUSTOMER 
  ---If you want to create a table structure similar to previous table then use like command---
  Create or replace table NT_CONSUMER_COMPLAINTS_COPY LIKE NT_CONSUMER_COMPLAINTS;
  ---IF YOU WANT TO CREATE TABLE ALONG WITH THE DATA SIMILAE TO THE PREVIOUS TABLE THEN USE AS COMMAND
  Create or replace table NT_CONSUMER_COMPLAINTS_DATA_COPY AS SELECT * FROM NT_CONSUMER_COMPLAINTS;
  select * from NT_CONSUMER_COMPLAINTS_DATA_COPY;
  
  ---IF THE CLIENT WANTS SAME STRUCTURE, BUT THE CLIENT NEEDS ONLY SOME COLUMN NOT ALL, THEN
  Create or replace table NT_CONSUMER_COMPLAINTS_DATA_COPY AS SELECT PRODUCT_NAME,SUB_PRODUCT,ISSUE
  FROM NT_CONSUMER_COMPLAINTS;
  select * from NT_CONSUMER_COMPLAINTS_DATA_COPY;
  
 
  
  
 ---ALTER COMMAND---
 ALTER TABLE NT_CONSUMER_COMPLAINTS
 ADD COLUMN CUSTOMER_AGE INT NOT NULL; ---- NOT NULL CANNOT BE ADDED IN TABLE WHICH HAS ALREADY EXISTING TABLE----
 
 ---NOT NULL CAN BE ADDED IN EMPTY TABLE--
 ALTER TABLE NT_CONSUMER_COMPLAINTS_COPY
 ADD COLUMN CUSTOMER_AGE INT NOT NULL;
 
 ---DEFAULT COMMAND---
 ALTER TABLE NT_CONSUMER_COMPLAINTS
 ADD COLUMN CUSTOMER_AGE INT DEFAULT 21;
 
 SELECT * FROM NT_CONSUMER_COMPLAINTS;
 
 ALTER TABLE NT_CONSUMER_COMPLAINTS
 ADD COLUMN CITY VARCHAR (20) DEFAULT 'NONE';
 
 ---ADD A COLUMN AND MAKE THAT AS PRIMARY KEY---THIS WILL WORK ON EMPTY TABLE, WHICH DOES NOT CONTAIN DATA---
 ALTER TABLE NT_CONSUMER_COMPLAINTS_COPY
 DROP PRIMARY KEY;
 
 ALTER TABLE NT_CONSUMER_COMPLAINTS_COPY
 ADD COLUMN AADHAAR_NUMBER VARCHAR(15) PRIMARY KEY;
 
 --PRIMARY KEY ON EXISTING COLUMN--
 ALTER TABLE NT_CONSUMER_COMPLAINTS
 DROP PRIMARY KEY;
 
 ALTER TABLE NT_CONSUMER_COMPLAINTS
 ADD PRIMARY KEY (ZIP_CODE);
 
 ---DROP PRIMARY KEY FROM THE EXISTING TABLE, ADD NEW COLUMN AND MAKE THAT AS PRIMARY KEY---WHEN THE TABLE IS NOT EMPTY---
 ALTER TABLE NT_CONSUMER_COMPLAINTS
 DROP PRIMARY KEY;
 --THEN ADD THE COLUMN AND THEN MAKE IT PRIMARY KEY USING 2 SREP PROCESS
 ALTER TABLE NT_CONSUMER_COMPLAINTS
 ADD COLUMN  AADHAAR_NUMBER VARCHAR(15);
 ALTER TABLE NT_CONSUMER_COMPLAINTS
 ADD PRIMARY KEY (AADHAAR_NUMBER);
 
 DESCRIBE TABLE NT_CONSUMER_COMPLAINTS;
 
 ---UPDATE COMMAND---
 UPDATE NT_CONSUMER_COMPLAINTS
 SET CUSTOMER_AGE = 35 WHERE PRODUCT_NAME IS NULL;
 
 USE WAREHOUSE DEMO_WAREHOUSE;
 

 
create or replace VIEW CUSTOM_CONSUMER_COMPLAINTS_VIEW AS 
SELECT *, CONCAT(STATE_NAME,'-',ZIP_CODE) AS STATE_ZIP_DETAILS
FROM NT_CONSUMER_COMPLAINTS
WHERE SUB_ISSUE IS NOT NULL 
AND CONSUMER_COMPLAINT_NARRATIVE IS NOT NULL
AND TAGS IS NOT NULL
AND SUB_PRODUCT IS NOT NULL
AND COMPANY_PUBLIC_RESPONSE IS NOT NULL;
SELECT * FROM CUSTOM_CONSUMER_COMPLAINTS_VIEW
